<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synoptic Weather Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #e9ecef;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 15vh;
            max-width: 800px;
            width: 100%;
        }
        .search-container {
            margin: 30px 0;
            max-width: 600px;
            width: 100%;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        #station-input {
            flex-grow: 1;
            border-radius: 20px;
            padding: 10px 20px;
            border: 1px solid #ced4da;
        }
        #search-button {
            border-radius: 20px;
            padding: 10px 30px;
            background-color: #007bff;
            border: none;
            transition: background-color 0.3s;
        }
        #search-button:hover {
            background-color: #0056b3;
        }
        #debug-section {
            max-width: 600px;
            margin: 20px 0;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 14px;
            word-wrap: break-word;
        }
        #time-display {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 14px;
            background-color: #fff;
            padding: 8px 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        #data-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            z-index: 2000;
            overflow-y: auto;
            padding: 40px;
        }
        #data-view-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .back-arrow {
            font-size: 1.8rem;
            cursor: pointer;
            color: #007bff;
            margin-right: 20px;
            transition: color 0.3s;
        }
        .back-arrow:hover {
            color: #0056b3;
        }
        #data-view-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #343a40;
        }
        #data-table-container {
            width: 100%;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
        }
        #data-table {
            width: 100%;
            min-width: 1000px;
            border-collapse: collapse;
            font-size: 14px;
        }
        #data-table th, #data-table td {
            border: 1px solid #dee2e6;
            padding: 12px 15px;
            min-width: 120px;
            text-align: left;
        }
        #data-table th {
            background-color: #343a40;
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        #data-table tr.highlighted {
            background-color: #f1f3f5;
        }
        #data-table td.high-low {
            font-weight: bold;
            color: #dc3545;
        }
        #fixed-measurements-row {
            width: 100%;
            background-color: #f1f3f5;
            border: 1px solid #dee2e6;
            font-size: 14px;
            position: sticky;
            top: 37px;
            z-index: 90;
            overflow-x: auto;
            white-space: nowrap;
        }
        #fixed-measurements-row table {
            width: 100%;
            min-width: 1000px;
            border-collapse: collapse;
        }
        #fixed-measurements-row td {
            border: 1px solid #dee2e6;
            padding: 12px 15px;
            min-width: 120px;
        }
        #summary-table {
            width: 100%;
            margin-top: 30px;
            border-collapse: collapse;
            font-size: 14px;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 10px;
        }
        #summary-table th, #summary-table td {
            border: 1px solid #dee2e6;
            padding: 12px 15px;
            text-align: left;
        }
        #summary-table th {
            background-color: #343a40;
            color: white;
        }
        #summary-table td.high-low {
            font-weight: bold;
            color: #dc3545;
        }
        .container h1 {
            font-size: 2.5rem;
            color: #343a40;
            margin-bottom: 30px;
            text-align: center;
        }
        @media (max-width: 576px) {
            body { padding: 15px; }
            .container { margin-top: 10vh; }
            .search-container { flex-direction: column; gap: 10px; }
            #debug-section, #time-display { font-size: 12px; margin: 15px; }
            #data-table-container { font-size: 12px; }
            .btn { font-size: 14px; padding: 8px 20px; }
            #data-table th, #data-table td { min-width: 80px; padding: 8px 10px; }
            #data-view { padding: 20px; }
            #data-view-title { font-size: 1.4rem; }
            #fixed-measurements-row { top: 33px; }
            #summary-table { font-size: 12px; }
            #time-display { top: 10px; left: 10px; }
            .container h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div id="main-view">
        <div id="time-display">Current Time (CDT): Loading...</div>
        <div class="container">
            <h1>Synoptic Weather Data</h1>
            <div class="search-container">
                <input type="text" id="station-input" class="form-control" value="KDFW" placeholder="Enter station ID (e.g., KDFW)">
                <button id="search-button" class="btn btn-primary">Search</button>
            </div>
            <div id="debug-section" class="text-start">
                <strong>Debug Info:</strong><br>
                <span id="debug-content">Enter a station ID and click Search</span>
            </div>
        </div>
    </div>
    <div id="data-view">
        <div id="data-view-header">
            <span class="back-arrow" onclick="toggleViews()">‚Üê</span>
            <h5 id="data-view-title">Station: KDFW | Last Updated: Loading...</h5>
        </div>
        <div id="data-table-container">
            <table id="data-table" class="table">
                <thead><tr><th>Timestamp</th></tr></thead>
                <tbody></tbody>
            </table>
            <div id="fixed-measurements-row">
                <table><tr id="fixed-measurements-content"><td>Latest Measurements</td></tr></table>
            </div>
        </div>
        <table id="summary-table">
            <thead><tr><th>Variable</th><th>Last Recorded Value</th></tr></thead>
            <tbody id="summary-table-body"></tbody>
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js"></script>
    <script>
        const API_TOKEN = '81ebbb6ea61247ac85cb88a96d97fcf2';
        const API_BASE_URL = 'https://api.synopticdata.com/v2/';
        let allObservations = [], allTimestamps = [], currentStationId = 'KDFW';
        const pressureTendencyCodes = {0:"Rising, then falling",1:"Rising slowly",2:"Rising steadily",3:"Rising quickly",4:"Steady",5:"Falling, then rising",6:"Falling slowly",7:"Falling steadily",8:"Falling quickly"};
        function toggleViews() {
            const mainView = $('#main-view'), dataView = $('#data-view');
            if (dataView.is(':visible')) { dataView.hide(); mainView.show(); }
            else { mainView.hide(); dataView.show(); }
        }
        function updateTimeDisplay() {
            const now = new Date();
            const options = { timeZone: 'America/Chicago', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            $('#time-display').text(`Current Time (CDT): ${now.toLocaleString('en-US', options)}`);
        }
        function updateDebug(content) {
            $('#debug-content').html(content.replace(/\n/g, '<br>'));
        }
        function convertToAmericanUnits(observations, variables) {
            const converted = {}, lastNonNullValues = {}, excludedVars = ['air_temp_high_6_hour_set_1','air_temp_low_6_hour_set_1','air_temp_high_24_hour_set_1','air_temp_low_24_hour_set_1','precip_accum_one_hour_set_1','precip_accum_three_hour_set_1','precip_accum_six_hour_set_1','precip_accum_24_hour_set_1'];
            variables.forEach(v => {
                if (!observations[v] || !Array.isArray(observations[v]) || observations[v].length !== allTimestamps.length) {
                    if (!excludedVars.includes(v)) { converted[v] = Array(allTimestamps.length).fill(null); lastNonNullValues[v] = 'N/A'; }
                    return;
                }
                let lastNonNull = null;
                converted[v] = observations[v].map((value, i) => {
                    if (value !== null && value !== '' && !isNaN(parseFloat(value))) {
                        lastNonNull = parseFloat(value);
                        if (v.includes('air_temp') || v.includes('heat_index') || v.includes('dew_point_temperature_set_1d') || v.includes('wet_bulb_temperature_set_1') || v.includes('wet_bulb_temp_set_1')) {
                            return (lastNonNull * 9/5 + 32).toFixed(2);
                        } else if (v.includes('wind_speed')) {
                            return (lastNonNull * 2.23694).toFixed(2);
                        } else if (v.includes('altimeter')) {
                            return (lastNonNull * 0.0002953).toFixed(2);
                        } else if (v.includes('pressure_set_1d') || v.includes('sea_level_pressure_set_1d')) {
                            return (lastNonNull * 0.01).toFixed(2);
                        } else if (v.includes('precip_accum')) {
                            return (lastNonNull * 0.03937).toFixed(3);
                        } else if (v.includes('ceiling')) {
                            return (lastNonNull * 3.28084).toFixed(0);
                        } else if (v.includes('pressure_tendency')) {
                            const code = Math.floor(lastNonNull / 1000), hPaChange = (lastNonNull % 1000) / 10;
                            const sign = code >= 0 && code <= 3 ? '+' : (code >= 5 && code <= 8 ? '-' : '');
                            return `${pressureTendencyCodes[code] || 'Unknown'}: ${sign}${hPaChange.toFixed(1)} hPa`;
                        }
                        return lastNonNull;
                    } else if ((v === 'weather_condition_set_1d' || v === 'weather_summary_set_1d' || v === 'wind_cardinal_direction_set_1d') && value) {
                        lastNonNull = value;
                        return value;
                    }
                    return lastNonNull !== null && !isNaN(lastNonNull) && !excludedVars.includes(v) ? 
                        (v.includes('air_temp') || v.includes('heat_index') || v.includes('dew_point_temperature_set_1d') || v.includes('wet_bulb_temperature_set_1') || v.includes('wet_bulb_temp_set_1') ? 
                        (lastNonNull * 9/5 + 32).toFixed(2) : v.includes('wind_speed') ? (lastNonNull * 2.23694).toFixed(2) : 
                        v.includes('altimeter') ? (lastNonNull * 0.0002953).toFixed(2) : v.includes('pressure_set_1d') || v.includes('sea_level_pressure_set_1d') ? 
                        (lastNonNull * 0.01).toFixed(2) : v.includes('precip_accum') ? (lastNonNull * 0.03937).toFixed(3) : 
                        v.includes('ceiling') ? (lastNonNull * 3.28084).toFixed(0) : v.includes('pressure_tendency') ? 
                        `${pressureTendencyCodes[Math.floor(lastNonNull / 1000)] || 'Unknown'}: ${(lastNonNull % 1000) / 10 * (Math.floor(lastNonNull / 1000) >= 0 && Math.floor(lastNonNull / 1000) <= 3 ? 1 : (Math.floor(lastNonNull / 1000) >= 5 && Math.floor(lastNonNull / 1000) <= 8 ? -1 : 0)).toFixed(1)} hPa` : 
                        lastNonNull) : (v === 'weather_condition_set_1d' || v === 'weather_summary_set_1d' || v === 'wind_cardinal_direction_set_1d') ? (value || 'N/A') : 'N/A';
                });
                lastNonNullValues[v] = lastNonNull !== null ? 
                    (v.includes('air_temp') || v.includes('heat_index') || v.includes('dew_point_temperature_set_1d') || v.includes('wet_bulb_temperature_set_1') || v.includes('wet_bulb_temp_set_1') ? 
                    (lastNonNull * 9/5 + 32).toFixed(2) : v.includes('wind_speed') ? (lastNonNull * 2.23694).toFixed(2) : 
                    v.includes('altimeter') ? (lastNonNull * 0.0002953).toFixed(2) : v.includes('pressure_set_1d') || v.includes('sea_level_pressure_set_1d') ? 
                    (lastNonNull * 0.01).toFixed(2) : v.includes('precip_accum') ? (lastNonNull * 0.03937).toFixed(3) : 
                    v.includes('ceiling') ? (lastNonNull * 3.28084).toFixed(0) : v.includes('pressure_tendency') ? 
                    `${pressureTendencyCodes[Math.floor(lastNonNull / 1000)] || 'Unknown'}: ${(lastNonNull % 1000) / 10 * (Math.floor(lastNonNull / 1000) >= 0 && Math.floor(lastNonNull / 1000) <= 3 ? 1 : (Math.floor(lastNonNull / 1000) >= 5 && Math.floor(lastNonNull / 1000) <= 8 ? -1 : 0)).toFixed(1)} hPa` : 
                    (v === 'weather_condition_set_1d' || v === 'weather_summary_set_1d' || v === 'wind_cardinal_direction_set_1d') ? lastNonNull : lastNonNull) : 
                    (v === 'weather_condition_set_1d' || v === 'weather_summary_set_1d' || v === 'wind_cardinal_direction_set_1d') && observations[v][observations[v].length - 1] ? 
                    observations[v][observations[v].length - 1] : 'N/A';
            });
            return { converted, lastNonNullValues };
        }
        function updateFixedMeasurementsRow(convertedObservations, sortedVariables, scrollTop) {
            const tableContainer = $('#data-table-container'), rows = $('#data-table tbody tr');
            if (!rows.length) return;
            const rowHeight = $(rows[0]).outerHeight() || 40;
            const firstVisibleRowIndex = Math.max(0, Math.floor(scrollTop / rowHeight));
            const latestValues = {};
            sortedVariables.forEach(v => {
                latestValues[v] = 'N/A';
                for (let i = 0; i <= firstVisibleRowIndex && i < convertedObservations[v].length; i++) {
                    if (convertedObservations[v][i] !== 'N/A' && convertedObservations[v][i] !== null) {
                        latestValues[v] = convertedObservations[v][i];
                        break;
                    }
                }
            });
            $('#fixed-measurements-content').html(`<td>Latest Measurements</td>${sortedVariables.map(v => `<td>${latestValues[v]}</td>`).join('')}`);
            $('#fixed-measurements-row').scrollLeft(tableContainer.scrollLeft());
        }
        function updateSummaryTable(observations) {
            const excludedVars = ['air_temp_high_6_hour_set_1','air_temp_low_6_hour_set_1','air_temp_high_24_hour_set_1','air_temp_low_24_hour_set_1','precip_accum_one_hour_set_1','precip_accum_three_hour_set_1','precip_accum_six_hour_set_1','precip_accum_24_hour_set_1'];
            const lastValues = {};
            excludedVars.forEach(v => {
                lastValues[v] = 'N/A';
                if (observations[v] && Array.isArray(observations[v])) {
                    for (let i = observations[v].length - 1; i >= 0; i--) {
                        const value = observations[v][i];
                        if (value !== null && value !== '' && !isNaN(parseFloat(value))) {
                            const parsedValue = parseFloat(value);
                            lastValues[v] = v.includes('air_temp') ? (parsedValue * 9/5 + 32).toFixed(2) : 
                                            v.includes('precip_accum') ? (parsedValue * 0.03937).toFixed(3) : parsedValue.toFixed(4);
                            break;
                        }
                    }
                }
            });
            $('#summary-table-body').html(excludedVars.map(v => {
                const label = v.replace('_set_1', '').replace(/_/g, ' ') + (v.includes('air_temp') ? ' (¬∞F)' : v.includes('precip_accum') ? ' (in)' : '');
                const cellClass = v.includes('air_temp') ? 'high-low' : '';
                return `<tr><td>${label}</td><td class="${cellClass}">${lastValues[v]}</td></tr>`;
            }).join(''));
        }
        function displayStationData(station) {
            if (!station || !station.OBSERVATIONS) {
                updateDebug('Error: No observation data');
                $('#data-table tbody').html('');
                $('#fixed-measurements-content').html('<td>Latest Measurements</td>');
                $('#summary-table-body').html('');
                $('#data-view-title').text(`Station: ${currentStationId} | Last Updated: N/A`);
                toggleViews();
                return;
            }
            allObservations = station.OBSERVATIONS;
            allTimestamps = (allObservations.date_time || []).slice().reverse();
            if (!allTimestamps.length) {
                updateDebug('Error: No timestamps in observations');
                $('#data-table tbody').html('');
                $('#fixed-measurements-content').html('<td>Latest Measurements</td>');
                $('#summary-table-body').html('');
                $('#data-view-title').text(`Station: ${currentStationId} | Last Updated: N/A`);
                toggleViews();
                return;
            }
            const allVariables = Object.keys(allObservations).filter(key => key !== 'date_time');
            const excludePatterns = /cloud_layer|metar|pressure_change_code|dew_point_temperature_set_1(?!d)|air_temp_high_6_hour_set_1|air_temp_low_6_hour_set_1|air_temp_high_24_hour_set_1|air_temp_low_24_hour_set_1|precip_accum_one_hour_set_1|precip_accum_three_hour_set_1|precip_accum_six_hour_set_1|precip_accum_24_hour_set_1|sea_level_pressure_set_1$|sea_level_pressure_tendency$|weather_cond_code_set_1/;
            const variables = allVariables.filter(v => !excludePatterns.test(v));
            const sortedVariables = [
                ...['air_temp_set_1','relative_humidity_set_1','wind_speed_set_1','heat_index_set_1d','weather_summary_set_1d','wind_cardinal_direction_set_1d','wind_gust_set_1','visibility_set_1','weather_condition_set_1d','dew_point_temperature_set_1d','ceiling_set_1','pressure_set_1d','sea_level_pressure_set_1d','altimeter_set_1','pressure_tendency_set_1','wet_bulb_temp_set_1d','wind_direction_set_1','peak_wind_speed_set_1','peak_wind_direction_set_1'].filter(v => variables.includes(v)),
                ...variables.filter(v => !['air_temp_set_1','relative_humidity_set_1','wind_speed_set_1','heat_index_set_1d','weather_summary_set_1d','wind_cardinal_direction_set_1d','wind_gust_set_1','visibility_set_1','weather_condition_set_1d','dew_point_temperature_set_1d','ceiling_set_1','pressure_set_1d','sea_level_pressure_set_1d','altimeter_set_1','pressure_tendency_set_1','wet_bulb_temp_set_1d','wind_direction_set_1','peak_wind_speed_set_1','peak_wind_direction_set_1'].includes(v))
            ];
            const filteredObservations = {};
            sortedVariables.forEach(v => {
                filteredObservations[v] = allObservations[v] && Array.isArray(allObservations[v]) && allObservations[v].length === allTimestamps.length ? allObservations[v].slice().reverse() : Array(allTimestamps.length).fill(null);
            });
            const { converted: convertedObservations, lastNonNullValues } = convertToAmericanUnits(filteredObservations, sortedVariables);
            $('#data-view-title').text(`Station: ${station.STID} | Last Updated: ${luxon.DateTime.now().setZone('America/Chicago').toFormat('MM/dd/yyyy HH:mm:ss')}`);
            const officialLabels = {
                "air_temp_set_1": "Air Temperature: ¬∞F", "relative_humidity_set_1": "Relative Humidity: %", "wind_speed_set_1": "Wind Speed: mph",
                "heat_index_set_1d": "Heat Index: ¬∞F", "weather_summary_set_1d": "Weather Summary", "wind_cardinal_direction_set_1d": "Wind Cardinal Direction",
                "wind_gust_set_1": "Wind Gust: mph", "weather_condition_set_1d": "Weather Condition", "dew_point_temperature_set_1d": "Dew Point Temperature: ¬∞F",
                "visibility_set_1": "Visibility: miles", "ceiling_set_1": "Ceiling Height: ft", "pressure_set_1d": "Station Pressure: mbar",
                "sea_level_pressure_set_1d": "Sea Level Pressure: mbar", "altimeter_set_1": "Altimeter Setting: inHg", "pressure_tendency_set_1": "Pressure Tendency",
                "wet_bulb_temp_set_1d": "Wet Bulb Temperature: ¬∞F", "wind_direction_set_1": "Wind Direction: ¬∞", "peak_wind_speed_set_1": "Peak Wind Speed: mph",
                "peak_wind_direction_set_1": "Peak Wind Direction: ¬∞"
            };
            $('#data-table thead tr').html(['Timestamp', ...sortedVariables.map(v => officialLabels[v] || v)].map(h => `<th>${h}</th>`).join(''));
            $('#fixed-measurements-content').html(`<td>Latest Measurements</td>${sortedVariables.map(v => `<td>${lastNonNullValues[v]}</td>`).join('')}`);
            $('#data-table tbody').html(allTimestamps.map((time, index) => {
                const parsedTime = luxon.DateTime.fromISO(time, { zone: 'America/Chicago' }).isValid ? 
                    luxon.DateTime.fromISO(time, { zone: 'America/Chicago' }).toFormat('MM/dd/yyyy HH:mm:ss') : '(invalid date)';
                return `<tr><td>${parsedTime}</td>${sortedVariables.map(v => `<td>${convertedObservations[v][index] !== null && convertedObservations[v][index] !== 'N/A' ? convertedObservations[v][index] : 'N/A'}</td>`).join('')}</tr>`;
            }).join(''));
            $('#data-table-container').off('scroll').on('scroll', function() {
                updateFixedMeasurementsRow(convertedObservations, sortedVariables, $(this).scrollTop());
                $('#fixed-measurements-row').scrollLeft($(this).scrollLeft());
            });
            updateSummaryTable(allObservations);
            toggleViews();
        }
        function fetchStationData(stationId, startDate, endDate) {
            const formatDate = date => `${date.getUTCFullYear()}${String(date.getUTCMonth() + 1).padStart(2, '0')}${String(date.getUTCDate()).padStart(2, '0')}${String(date.getUTCHours()).padStart(2, '0')}${String(date.getUTCMinutes()).padStart(2, '0')}`;
            const startFormatted = formatDate(startDate), endFormatted = formatDate(endDate);
            if (!startFormatted || !endFormatted) {
                updateDebug('Error: Invalid date formatting');
                return;
            }
            const url = `${API_BASE_URL}stations/timeseries?stid=${stationId}&start=${startFormatted}&end=${endFormatted}&token=${API_TOKEN}&obtimezone=local`;
            updateDebug(`API URL: ${url}\nStatus: Fetching...`);
            $.ajax({
                url: url,
                method: 'GET',
                success: function(data, status, xhr) {
                    updateDebug(`API URL: ${url}\nStatus: Success\nHTTP Status: ${xhr.status}\nResponse Size: ${JSON.stringify(data).length} bytes`);
                    if (data.STATION && data.STATION[0] && data.STATION[0].OBSERVATIONS && data.SUMMARY.RESPONSE_CODE === 1) {
                        currentStationId = data.STATION[0].STID;
                        displayStationData(data.STATION[0]);
                    } else {
                        updateDebug(`API URL: ${url}\nStatus: Failed\nError: Station name invalid\nResponse: ${data.SUMMARY?.RESPONSE_MESSAGE || 'Unknown error'}`);
                        alert('Station name invalid. Check debug info.');
                        $('#data-table tbody').html('');
                        $('#fixed-measurements-content').html('<td>Latest Measurements</td>');
                        $('#summary-table-body').html('');
                        $('#data-view-title').text(`Station: ${stationId} | Last Updated: N/A`);
                        toggleViews();
                    }
                },
                error: function(xhr) {
                    updateDebug(`API URL: ${url}\nStatus: Failed\nError: Station name invalid\nResponse: ${xhr.responseText || 'N/A'}`);
                    alert('Station name invalid. Check debug info.');
                    $('#data-table tbody').html('');
                    $('#fixed-measurements-content').html('<td>Latest Measurements</td>');
                    $('#summary-table-body').html('');
                    $('#data-view-title').text(`Station: ${stationId} | Last Updated: N/A`);
                    toggleViews();
                }
            });
        }
        $(document).ready(function() {
            let currentEndDate = new Date(), currentStartDate = new Date(currentEndDate.getTime() - 3 * 24 * 60 * 60 * 1000);
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 1000);
            $('#search-button').on('click', function() {
                const stationId = $('#station-input').val().trim().toUpperCase();
                if (stationId) {
                    currentEndDate = new Date();
                    currentStartDate = new Date(currentEndDate.getTime() - 3 * 24 * 60 * 60 * 1000);
                    fetchStationData(stationId, currentStartDate, currentEndDate);
                } else {
                    updateDebug('Status: Failed\nError: Station ID cannot be empty');
                    alert('Please enter a station ID.');
                }
            });
            $('#station-input').on('keypress', function(e) {
                if (e.which === 13) $('#search-button').click();
            });
        });
    </script>
</body>
</html>
